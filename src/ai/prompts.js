/**
 * AI Prompts для генерации контента
 * 
 * Этот файл содержит все промпты для Gemini AI.
 * Вы можете редактировать промпты здесь для улучшения результатов.
 */

/**
 * Промпт для генерации досье поэта
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetBioPrompt = (poetName) => {
  return `Составь краткое досье на ${poetName} в виде списка (карточки) с полями (каждое поле с новой строки - следуй формату):
Полное имя
Годы жизни
Национальность
Происхождение
Место рождения
Место смерти (не только город, но и если известно место)
Причина смерти
Возраст смерти
Сделай ответ компактным, в виде списка, как карточку.

Пример досье:
Полное имя: Александр Сергеевич Пушкин
Годы жизни: 6 июня 1799 - 10 февраля 1837
Национальность: русский
Происхождение: дворянское; по материнской линии — потомок африканского рода Ганнибалов.
Место рождения: Москва, в родовом имении дворян Пушкиных
Место смерти: Санкт-Петербург, в квартире на набережной Мойки
Причина смерти: смертельное ранение на дуэли
Возраст смерти: 37 лет
ВАЖНО: НЕ используй markdown форматирование! Только чистый текст.`;
};

// Здесь можно добавить другие промпты для будущих функций
// Например:

/**
 * Промпт для генерации анализа стиля поэта (для будущего использования)
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetStyleAnalysisPrompt = (poetName) => {
  return `Проанализируй поэтический стиль ${poetName}. Опиши в 2-3 предложениях:
1. Основные темы творчества
2. Особенности стиля и языка
3. Мораль и влияние на литературу

Ответ должен быть кратким и информативным.`;
};

/**
 * Промпт для сравнения двух поэтов (для будущего использования)
 * @param {string} poet1 - Имя первого поэта
 * @param {string} poet2 - Имя второго поэта
 * @returns {string} - Промпт для AI
 */
export const comparePoetsPrompt = (poet1, poet2) => {
  return `Сравни творчество ${poet1} и ${poet2}. 
Укажи:
1. Общие черты в творчестве
2. Ключевые различия
3. Кто на кого повлиял (если применимо)

Ответ в 3-4 предложениях.`;
};

/**
 * Промпт для генерации случайного стихотворения поэта
 * @param {string} poetName - Имя поэта
 * @param {Array<string>} existingPoems - Список уже добавленных стихотворений
 * @returns {string} - Промпт для AI
 */
export const generateRandomPoemPrompt = (poetName, existingPoems = []) => {
  const excludeList = existingPoems.length > 0 
    ? ` кроме следующих: ${existingPoems.join(', ')}` 
    : '';
  return `Найди случайное (желательно не слишком известное) стихотворение поэта ${poetName} кроме следующих: ${excludeList}. 
Ответ представь в виде 1й строки - название стихотворения (если нет названия, то первая строчка стихотворения).
ВАЖНО: Только название, без дополнительного текста, кавычек! Не придумывай только, нужно именно существующее стихотворение поэта ${poetName}!`;
};

/**
 * Промпт для генерации популярного стихотворения поэта
 * @param {string} poetName - Имя поэта
 * @param {Array<string>} existingPoems - Список уже добавленных стихотворений
 * @returns {string} - Промпт для AI
 */
export const generatePopularPoemPrompt = (poetName, existingPoems = []) => {
  const excludeList = existingPoems.length > 0 
    ? ` кроме следующих: ${existingPoems.join(', ')}` 
    : '';
  return `Найди случайно одно из популярных/известных стихотворений поэта ${poetName} кроме следующих: ${excludeList}. 
Ответ представь в виде 1й строки - название стихотворения (если нет названия, то первая строчка стихотворения).
ВАЖНО: Только название, без дополнительного текста, кавычек! Не придумывай только, нужно именно существующее стихотворение поэта ${poetName}!`;
};

/**
 * Промпт для генерации стихотворения на тему
 * @param {string} poetName - Имя поэта
 * @param {string} theme - Тема стихотворения
 * @param {Array<string>} existingPoems - Список уже добавленных стихотворений
 * @returns {string} - Промпт для AI
 */
export const generateThemedPoemPrompt = (poetName, theme, existingPoems = []) => {
  const excludeList = existingPoems.length > 0 
    ? ` кроме следующих: ${existingPoems.join(', ')}` 
    : '';
  return `Найди случайное стихотворение поэта ${poetName} на тему "${theme}" кроме следующих: ${excludeList}. 
Ответ представь в виде 1й строки - название стихотворения (если нет названия, то первая строчка стихотворения).
ВАЖНО: Только название, без дополнительного текст, кавычек! Не придумывай только, нужно именно существующее стихотворение поэта ${poetName}!`;
};

/**
 * Доступные темы для генерации стихотворений
 */
export const POEM_THEMES = [
  'любовь',
  'жизнь/смерть',
  'свобода',
  'общество',
  'мама/семья',
  'природа',
  'война',
  'родина',
  'фантастика',
  'детские',
  'смешные/шуточные',
  'очень короткие'
];

/**
 * Варианты генерации стихотворений (для dropdown)
 */
export const POEM_GENERATION_OPTIONS = [
  { value: 'random', label: 'Случайное' },
  { value: 'popular', label: 'Популярное' },
  { value: 'очень короткие', label: 'Очень короткие' },
  ...POEM_THEMES.filter(t => t !== 'очень короткие').map(theme => ({
    value: theme,
    label: theme.charAt(0).toUpperCase() + theme.slice(1)
  }))
];

/**
 * Промпт для генерации биографии поэта (жизненный путь по годам)
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetLifeStoryPrompt = (poetName) => {
  return `Мне нужен живой, но КРАТКИЙ и понятный рассказ о жизни поэта ${poetName} — по годам, как цепочка значимых событий и этапов его жизни.

Важно: это должна быть не сухая биография, а человеческий рассказ, показывающий, как он рос, что с ним происходило, какие люди и ситуации на него влияли.

При этом НЕ нужно обсуждать творчество (только если это важно для понимания жизни поэта), анализировать его произведения, перечислять работы или давать оценки. Только жизненный путь.

Структура (строго следовать ей):

1) Подзаголовок в формате: Год/годы — событие/события

2) Новый абзац с подробным описанием того, что происходило в этот период, с объяснением контекста.

Требования:

- Каждый подзаголовок должен быть отделён от описания новой строкой.

- Если упоминаешь людей, обязательно поясняй, кто они (например: поэт, друг семьи, писатель, двоюродный брат).

- Добавляй важные детали, поясняй причины событий.

- Избегай общих фраз вроде «он рос талантливым», «это сильно повлияло на творчество».

- Всё должно выглядеть как последовательная, живая история человека от детства до смерти.

ВАЖНО - Без списков, оглавлений, итогов, смайликов — только структура «подзаголовок (годы - событие) → абзац текста». ничего кроме этого текста`;
};

/**
 * Промпт для генерации информации о морали поэта
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetInfluencePrompt = (poetName) => {
  return `Задаяа: Дай мне только факты о реальных поступках поэта ${poetName}, которые имеют очевидную морально-этическую оценку (показывают его Примеры поступков: помощь людям, отказ в помощи, защита слабых, причинение вреда, благотворительность, участие в спасении, участие в причинении вреда, предательство, обман, верность, честность в поступках, жестокость, насилие, жесткие решения, самопожертвование, использование людей в личных целях, манипуляции, злоупотребление властью, поддержка друзей, давление на других людей, зло, добро, кража, финансовая нечестность, долговая порядочность или непорядочность, выполнение взятых обязательств или отказ от них, вмешательство в чужую судьбу, разрушение чужой жизни, помощь в устройстве судьбы других людей, уклонение от ответственности, стремление исправить нанесённый вред, участие в конфликтах, действия ради выгоды, действия из альтруизма, вероломство, месть, жесткое обращение с подчинёнными, злоупотребления по службе, защита коллег, враждебные поступки, попытки примирения, нарушение закона, соблюдение закона в сложной ситуации, сокрытие правды, признание ошибок, добрые личные поступки, личная жестокость, бескорыстная поддержка, использование положения для личной пользы.

Требования:
- суперкоротко и по делу, максимум 15 фактов (но если нет достаточно достоверных фактов, то меньше) принципы, доброту, жестокость, прагматизм и т. п.). Это могут быть поступки по отношению к другим людям, поступки по отношению к обществу, личное поведение, поступки в профессиональной среде.
- только факты, прочитав которые я смогу понять моральные принципы человека
- Никаких оценок, комментариев, выводов
- Если факт ничего не говорит о морали, принципах, то не добавляй.
- ФОРМАТ — СЛЕДУЙ СТРОГО ЕМУ — никакого лишнего текста даже общего заголовка не нужно. Структурируй ответ по пунктам: каждый пункт с новой строки начинай со слова ПУНКТ
- САМОЕ ВАЖНОЕ  - факты должны быть 100% достоверными, используй только надежные источники (википедия на руссокм, например), перепроверь их перед отправкой еще раз
- САМОЕ ВАЖНОЕ - не выдумывай сам ничего, только факты, перепроверяй каждый факт`;
};

/**
 * Промпт для генерации информации о творчестве поэта
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetCreativityPrompt = (poetName) => {
  return `Дай короткую сводку информации о творчестве ${poetName}, мне нужно коротко, по делу и понятно.

1) Вид деятельности - это может быть поэт, писатель, прозаик, драматург, критик, переводчик, публицист, философ, историк и так далее. укажи от самого главного к наименее важным
2) Тематика - о чем писал, какие темы затрагивал
3) Стиль творчества - это может быть классицизм, романтизм, импрессионизм, символизм, экспрессионизм, декаданс, постмодернизм и так далее.
4) Влияние - люди (поэты/писатели/другие), которые повлияли на его творчество (прочерк если нет) - перечисли
5) Влияние на - люди (поэты/писатели/другие), на которых он повлиял (прочерк если нет) - перечисли

Следуй формату ниже СТРОГО. ВАЖНО: от себя не добавляй никакого текста, общих заголовков, смайликов. ВАЖНО: Каждый пункт с новой строки!

Вид деятельности: текст

Тематика: текст

Стиль: текст

Влияние: текст

Влияние на: текст`;
};

/**
 * Промпт для генерации информации о драме в жизни поэта
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetDramaPrompt = (poetName) => {
  return `Дай мне факты о русском поэте ${poetName}, которые можно использовать для оценки категории «Драма».

Здесь оценивается степень трагичности жизни поэта, жизненные испытания, страдания, утраты, судьба, тяжелые болезни, смерть близких, неразделённая любовь, тяжёлые жизненные периоды, одиночество, дуэли, конфликты, тюрьма, ссылки, эмиграция, изгнание, преследования, участие в революциях или бунтах, любовные истории, внутренние кризисы, разрушенные отношения, саморазрушение, зависимость, моральные конфликты, самоубийство, смерть.

ВАЖНО - Не добавляй оценок или выводов — только факты, только настоящая ДРАМА, а не биография

ВАЖНО - суперкоротко

ФОРМАТ: слово ФАКТ и затем сам факт`;
};

/**
 * Промпт для генерации информации о красоте поэта
 * @param {string} poetName - Имя поэта
 * @returns {string} - Промпт для AI
 */
export const generatePoetBeautyPrompt = (poetName) => {
  return `Дай мне факты о русском поэте ${poetName}, которые можно использовать для оценки категории «Красота».

Здесь оценивается внешняя привлекательность, обаяние/харизма. Стиль, следил ли за модой

Сначала предоставь Внешние черты, рост и другие параметры

Стиль и вкус: одежда, прическа, внешний вид, ухоженность, особенности имиджа, мода того времени.

Обаяние и харизма: насколько он нравился окружающим (именно внешне)

ВАЖНО - Не добавляй оценок или выводов — только факты, относящиеся к внешности

ВАЖНО - суперкоротко

ВАЖНО - следуй формату ниже и не добавляй ничего от себя

ФОРМАТ:

Внешние черты

слово ПУНКТ текст и так далее

Стиль и вкус

слово ПУНКТ текст и так далее

Обаяние и харизма

слово ПУНКТ текст и так далее`;
};

/**
 * Промпт для AI-критика для оценки ТВОРЧЕСТВА поэта
 * @param {string} poetName - Имя поэта для оценки
 * @param {Array} existingRatings - Массив уже оцененных поэтов [{name, ratings: {creativity}}]
 * @returns {string} - Промпт для генерации AI-рейтинга творчества
 */
export const generateAIRatingCreativityPrompt = (poetName, existingRatings = []) => {
  // Формируем секцию с уже оцененными поэтами (если есть)
  let contextSection = '';
  if (existingRatings.length > 0) {
    const ratingsText = existingRatings
      .slice(0, 50)
      .map(p => `${p.name}: ${p.ratings.creativity}`)
      .join('\n');
    
    contextSection = `\n\nДля калибровки: вот твои оценки других поэтов:\n${ratingsText}\n\nИспользуй эти оценки как ориентир, чтобы быть последовательным и справедливым.\n`;
  }
  
  return `Представь, что ты — строгий, объективный литературный критик.

Оцени ТВОРЧЕСТВО поэта ${poetName} по пятибалльной шкале (0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5).

Творчество - оцени свое впечатление от СТИХОВ поэта (ВАЖНО - именно стихи! а не любые произведения):

${contextSection}
Формат ответа: только оценка (число от 0 до 5 с шагом 0.5)`;
};

/**
 * Промпт для AI-критика для оценки МОРАЛИ поэта
 * @param {string} poetName - Имя поэта для оценки
 * @param {Array} existingRatings - Массив уже оцененных поэтов [{name, ratings: {influence}}]
 * @returns {string} - Промпт для генерации AI-рейтинга морали
 */
export const generateAIRatingMoralPrompt = (poetName, existingRatings = []) => {
  let contextSection = '';
  if (existingRatings.length > 0) {
    const ratingsText = existingRatings
      .slice(0, 50)
      .map(p => `${p.name}: ${p.ratings.influence}`)
      .join('\n');
    
    contextSection = `\n\nДля калибровки: вот твои оценки других поэтов:\n${ratingsText}\n`;
  }
  
  return `Представь, что ты — строгий, объективный судья конкурса морали.

Оцени МОРАЛЬ и этическое поведение (наскольок хороший/плохой человек) поэта ${poetName} по пятибалльной шкале (0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5) исходя из фактов его биографии и поступков.
Плохие: предательство, измена, ложь, кража, убийство, жестокость, корысть, эгоизм, насилие, манипуляция, лицемерие, бездушие, пренебрежение другими, нарушение законов, эксплуатация, жестокое обращение с близкими.
Хорошие: помощь, щедрость, честность, верность, самоотверженность, защита других, справедливость, доброта, уважение к людям, благотворительность, моральная смелость, поддержка друзей и семьи, соблюдение обещаний, моральная последовательность.

${contextSection}
Формат ответа: только оценка (число от 0 до 5 с шагом 0.5)`;
};

/**
 * Промпт для AI-критика для оценки ДРАМЫ поэта
 * @param {string} poetName - Имя поэта для оценки
 * @param {Array} existingRatings - Массив уже оцененных поэтов [{name, ratings: {drama}}]
 * @returns {string} - Промпт для генерации AI-рейтинга драмы
 */
export const generateAIRatingDramaPrompt = (poetName, existingRatings = []) => {
  let contextSection = '';
  if (existingRatings.length > 0) {
    const ratingsText = existingRatings
      .slice(0, 50)
      .map(p => `${p.name}: ${p.ratings.drama}`)
      .join('\n');
    
    contextSection = `\n\nДля калибровки: вот твои оценки других поэтов:\n${ratingsText}\n\nИспользуй эти оценки как ориентир, чтобы быть последовательным и справедливым.\n`;
  }
  
  return `Представь, что ты — строгий, объективный судья конкурса драмы.

Оцени ДРАМУ в жизни поэта ${poetName} по пятибалльной шкале (0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5).

Драма - степень трагичности жизни поэта:
- Трагические и драматические события (в разныз сферах жизни) на протяжении всей жизни поэта
- примеры событий: несчастная любовь, тяжелая болезнь, бедность, эмиграция, изгнание, политические репрессии, тюремное заключение, депрессия, алкоголизм, социальная изоляция, одиночество, предательства, несправедливость, суецид и так далее

${contextSection}
Формат ответа: только оценка (число от 0 до 5 с шагом 0.5)`;
};

/**
 * Промпт для AI-критика для оценки КРАСОТЫ поэта
 * @param {string} poetName - Имя поэта для оценки
 * @param {Array} existingRatings - Массив уже оцененных поэтов [{name, ratings: {beauty}}]
 * @returns {string} - Промпт для генерации AI-рейтинга красоты
 */
export const generateAIRatingBeautyPrompt = (poetName, existingRatings = []) => {
  let contextSection = '';
  if (existingRatings.length > 0) {
    const ratingsText = existingRatings
      .slice(0, 50)
      .map(p => `${p.name}: ${p.ratings.beauty}`)
      .join('\n');
    
    contextSection = `\n\nДля калибровки: вот твои оценки других поэтов:\n${ratingsText}\n\nИспользуй эти оценки как ориентир, чтобы быть последовательным и справедливым.\n`;
  }
  
  return `Представь, что ты — строгий, объективный судья конкурса красоты.

Оцени КРАСОТУ поэта ${poetName} по пятибалльной шкале (0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5).

Красота - внешность поэта:
- Внешняя привлекательность (самая важная часть оценки)
- Обаяние, личный шарм
- Манера одеваться, стиль, следит ли за модой
- никак не относится к творчеству, это внешность

${contextSection}
Формат ответа: только оценка (число от 0 до 5 с шагом 0.5)`;
};

/**
 * УСТАРЕВШИЙ промпт - оставлен для обратной совместимости
 * Промпт для AI-критика, который оценивает поэта по 4 категориям
 * @param {string} poetName - Имя поэта для оценки
 * @param {Array} existingRatings - Массив уже оцененных поэтов [{name, ratings: {creativity, influence, drama, beauty}}]
 * @returns {string} - Промпт для генерации AI-рейтинга
 */
export const generateAIRatingPrompt = (poetName, existingRatings = []) => {
  // Формируем секцию с уже оцененными поэтами (если есть)
  let contextSection = '';
  if (existingRatings.length > 0) {
    const ratingsText = existingRatings
      .slice(0, 1) // Берем максимум 10 поэтов для контекста
      .map(p => 
        `${p.name}: Творчество ${p.ratings.creativity}, Мораль ${p.ratings.influence}, Драма ${p.ratings.drama}, Красота ${p.ratings.beauty}`
      )
      .join('\n');
    
    contextSection = `\n\nДля калибровки: вот твои оценки других поэтов в этой битве:\n${ratingsText}\n\nИспользуй эти оценки как ориентир, чтобы быть последовательным и справедливым.\n`;
  }
  
  return `Представь, что ты — строгий, объективный литературный критик.

Твоя задача — оценивать поэтов по нескольким критериям, чтобы в итоге можно было определить победителя «битвы поэтов».
Шкала оценивания - Используются оценки по пятибалльной шкале, включая половинные значения: 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5

Категории:

1. Творчество
- как будто ты оцениваешь свое впечатление от стихов (ВАЖНО -именно стихи! а не любые произведения)

2. Мораль - нравственность, поступки
 - Это могут быть поступки по отношению к другим людям, поступки по отношению к обществу, личное поведение, поступки в профессиональной среде.
 - по сути это моральные принципы человека (хороший или плохой упрощенно)
3. Драма - степень трагичности жизни поэта
- трагические или драматические события в жизни
- страдания, утраты, судьба, тяжелые болезни, смерть близких, неразделённая любовь, тяжёлые жизненные периоды, одиночество, дуэли, конфликты, тюрьма, ссылки, эмиграция, изгнание, преследования, участие в революциях или бунтах, любовные истории, внутренние кризисы, разрушенные отношения, саморазрушение, зависимость, моральные конфликты, самоубийство, смерть

4. Красота - Оценивается внешность поэта (это самое важное), его харизма и впечатление, которое он производил:
- привлекательность - самое важное
- обаяние, личный шарм
- манера одеваться, стиль
- ухоженность, внешний вид

Формат ответа критика:
только Название категории: оценка (без любого другого текста и обоснований). Например:
Творчество: 3
Мораль: 2.5
Драма: 4
Красота: 1.5

${contextSection}
А теперь оцени поэта ${poetName}.`;
};

/**
 * Парсит одиночное число из ответа AI
 * @param {string} aiResponse - Ответ AI (просто число, например "3.5")
 * @returns {number} - Оценка (или 0 если не удалось распарсить)
 */
export const parseSingleRating = (aiResponse) => {
  try {
    // Ищем число от 0.5 до 5 с возможным .5
    const match = aiResponse.match(/([0-5](?:\.[05])?|0\.5)/);
    
    if (match) {
      const rating = parseFloat(match[1]);
      
      // Проверка валидности (от 0.5 до 5, с шагом 0.5)
      if (rating >= 0.5 && rating <= 5 && (rating * 2) % 1 === 0) {
        return rating;
      }
    }
    
    console.warn('Не удалось распарсить оценку из ответа AI:', aiResponse);
    return 0;
  } catch (error) {
    console.error('Ошибка при парсинге оценки AI:', error);
    return 0;
  }
};

/**
 * Парсит ответ AI-критика и извлекает оценки по категориям
 * УСТАРЕВШАЯ ФУНКЦИЯ - оставлена для обратной совместимости
 * @param {string} aiResponse - Ответ AI в формате "Творчество: 3\nМораль: 2.5..."
 * @returns {Object} - Объект с оценками { creativity, influence, drama, beauty }
 */
export const parseAIRating = (aiResponse) => {
  const ratings = {
    creativity: 0,
    influence: 0,
    drama: 0,
    beauty: 0
  };

  try {
    // Ищем строки с оценками
    const creativityMatch = aiResponse.match(/Творчество[:\s]+([0-5](?:\.[05])?)/i);
    const influenceMatch = aiResponse.match(/Мораль[:\s]+([0-5](?:\.[05])?)/i);
    const dramaMatch = aiResponse.match(/Драма[:\s]+([0-5](?:\.[05])?)/i);
    const beautyMatch = aiResponse.match(/Красота[:\s]+([0-5](?:\.[05])?)/i);

    if (creativityMatch) ratings.creativity = parseFloat(creativityMatch[1]);
    if (influenceMatch) ratings.influence = parseFloat(influenceMatch[1]);
    if (dramaMatch) ratings.drama = parseFloat(dramaMatch[1]);
    if (beautyMatch) ratings.beauty = parseFloat(beautyMatch[1]);

    // Проверка валидности оценок (от 1 до 5, с шагом 0.5)
    for (const [key, value] of Object.entries(ratings)) {
      if (value < 1 || value > 5 || (value * 2) % 1 !== 0) {
        console.warn(`Некорректная оценка для ${key}: ${value}. Устанавливаем 0`);
        ratings[key] = 0;
      }
    }

  } catch (err) {
    console.error('Ошибка парсинга AI-рейтинга:', err);
  }

  return ratings;
};

/**
 * Промпт для выбора победителя при одинаковом AI-балле (тайбрейкер)
 * @param {Array} poets - Массив поэтов с одинаковым AI-баллом
 * @returns {string} - Промпт для разрешения ничьей
 */
export const generateAITiebreakerPrompt = (poets) => {
  const poetsList = poets.map((poet, index) => 
    `${index + 1}. ${poet.name} (Творчество: ${poet.aiRatings.creativity}, Мораль: ${poet.aiRatings.influence}, Драма: ${poet.aiRatings.drama}, Красота: ${poet.aiRatings.beauty})`
  ).join('\n');
  
  return `Ты — искусственный интеллект и критик, который оценивает поэтов.

У нескольких поэтов получился одинаковый средний балл по всем категориям (Творчество, Мораль, Драма, Красота).

Поэты с одинаковым баллом:
${poetsList}

Твоя задача — выбрать ОДНОГО победителя из этого списка.
Рассмотри их оценки по всем категориям и выбери того, кто, по твоему мнению, заслуживает награду "Выбор ИИ" больше всех.

ВАЖНО: В ответе напиши ТОЛЬКО имя победителя, без дополнительных объяснений и обоснований.
Формат ответа: Имя Фамилия (точно как в списке выше)`;
};

/**
 * Парсит ответ AI-тайбрейкера и извлекает имя победителя
 * @param {string} aiResponse - Ответ AI с именем победителя
 * @param {Array} poets - Массив поэтов-кандидатов
 * @returns {string|null} - ID победителя или null
 */
export const parseAITiebreaker = (aiResponse, poets) => {
  try {
    const cleanResponse = aiResponse.trim();
    
    // Ищем поэта по имени в ответе
    for (const poet of poets) {
      if (cleanResponse.includes(poet.name)) {
        return poet.id;
      }
    }
    
    console.warn('AI-тайбрейкер не смог найти победителя:', cleanResponse);
    return null;
  } catch (err) {
    console.error('Ошибка парсинга AI-тайбрейкера:', err);
    return null;
  }
};

/**
 * Промпт для генерации случайного русского поэта
 * @param {Array} existingPoets - Массив уже добавленных поэтов (имена)
 * @returns {string} - Промпт для генерации
 */
export const generateRandomPoetPrompt = (existingPoets) => {
  const excludeList = existingPoets.length > 0 
    ? `\n\nПоэты, которые УЖЕ есть в системе (НЕ используй их):\n${existingPoets.join(', ')}`
    : '';
  
  return `Ты — эксперт по русской литературе.

Твоя задача — предложить ОДНОГО случайного русского поэта (или писателя, который также писал стихи).

Требования:
1. Это должен быть реальный исторический поэт (любой эпохи)
2. Он должен писать на русском языке
3. Выбери СЛУЧАЙНОГО поэта, не обязательно самого известного, но можно и известного
5. ${excludeList}

ВАЖНО: В ответе напиши ТОЛЬКО полное имя и фамилию поэта (например: "Александр Пушкин" или "Анна Ахматова").
Никаких дополнительных объяснений, дат, биографии — только Имя Фамилия.`;
};
